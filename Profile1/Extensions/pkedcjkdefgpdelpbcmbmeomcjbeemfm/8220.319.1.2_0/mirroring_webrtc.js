'use strict';var Gva={TAB:0,Nl:1,sq:2},Y$=function(a){Bb("MediaRouter.WebRtc.Start.Success",a,Gva)};var Z$=function(a,b){aj.call(this,b);this.G=a;this.l=new Cb;this.g=tt(b.id);this.C=new Cb;this.w=!1;this.o=null;this.F=!1;this.s=this.m=null;Hva(this);Iva(this);this.g.sendMessage(new gj("GET_TURN_CREDENTIALS"))};q(Z$,aj);
Z$.prototype.start=function(a){var b=this;return this.l.g.then(function(c){if(c.g)return Promise.reject(new ui("Mirroring already started"));if(b.o)return Promise.reject(new ui("Session permanently stopped"));b.m=new rb("MediaRouter.WebRtc.Session.Launch");c.ja.addStream(a);c.start();return b.C.g})};
Z$.prototype.stop=function(){var a=this;this.C.reject(new ui("Session stop requested."));this.s&&(this.s.end(),this.s=null);if(this.o)return this.o;this.F=this.w=!1;this.m=null;return this.o=this.l.g.then(function(b){b.stop()}).then(function(){return a.g.Wa()}).catch(function(b){a.g.Wa();throw b;})};
var Hva=function(a){a.g.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.l.resolve(new kj(a.h.id,b.data.credentials));break;case "ANSWER":a.l.g.then(function(c){qj(c,b.data)});break;case "KNOCK_ANSWER":a.F=!0;a.l.g.then(function(c){qj(c,b.data)});break;case "STOP":a.C.reject(new ui("Stop signal received"));a.stop();break;default:throw new ui("Unknown message type: "+b.type);}}},Iva=function(a){a.l.g.then(function(b){oj(b,function(c){a.g.sendMessage(new gj("OFFER",
new ij(c,a.G,jj)))});pj(b,function(c){c=hj(c);a.g.sendMessage(c)});lj(b,function(){a.w=!0;a.g.sendMessage(new gj("SESSION_START_SUCCESS"));!a.F&&a.m&&a.m.end();a.m=null;a.s=new xb("MediaRouter.WebRtc.Session.Length");a.C.resolve(a)});nj(b,function(){a.g.sendMessage(new gj("SESSION_END"))});mj(b,function(c){a.w||a.C.reject(c);a.g.sendMessage(new gj("SESSION_FAILURE"))})})};var $$=function(){Ti.call(this,"webrtc")};q($$,Ti);h=$$.prototype;h.Qh=function(a,b){return new Z$(a,b)};h.th=function(){Y$(0)};h.qh=function(){Y$(1)};h.yi=function(){Y$(2)};h.rh=function(){Ab("MediaRouter.WebRtc.Session.End")};h.Yf=function(a){Bb("MediaRouter.WebRtc.Start.Failure",a,ti)};h.sh=function(){Ab("MediaRouter.WebRtc.Stream.End")};var Jva=new $$;Mi("mr.mirror.webrtc.WebRtcService",Jva);
