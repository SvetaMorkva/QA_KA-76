var MtgPuzzle=function(i){var n={};function a(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=i,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e),i.d(e,"Special",function(){return n});i(0);function d(t,e){var i=1<arguments.length&&void 0!==e?e:"Click",n="".concat(a.analyticsCategory," — ").concat(t," — ").concat(i);void 0!==window.dataLayer&&a.analyticsCategory&&window.dataLayer.push({event:"data_event",data_description:n})}var a={name:"MtgPuzzle",analyticsCategory:"MTG Puzzle (2)",sendPageView:!1,listenedEvents:["click"]};function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.keyCodes={enter:13},this.params={container:document.body},a.sendPageView&&void 0!==window.dataLayer&&window.dataLayer.push({event:"Page — View",post_details:{},section:"special",tags:[],title:document.title,url:window.location.pathname})}var e,i,n;return e=t,(i=[{key:"saveParams",value:function(){Object.assign(this.params,a),this.container=this.params.container,this.addEventListeners()}},{key:"loadStyles",value:function(n){return new Promise(function(t,e){var i=document.createElement("link");i.rel="stylesheet",i.href=n,i.onload=function(){return t()},i.onerror=function(){return e()},document.body.appendChild(i)})}},{key:"addEventListeners",value:function(){var i=this;this.params.listenedEvents.forEach(function(e){i.container.addEventListener(e,function(t){return i.defaultEventHandler(t,e)})})}},{key:"defaultEventHandler",value:function(t,e){for(var i,n=t.target;n.parentNode&&n!==t.currentTarget&&(i=n.dataset[e],"click"===e&&"a"===n.tagName.toLowerCase()&&d(this.typeShowing?"".concat(this.typeShowing," — ").concat(n.href):n.href),!i);)n=n.parentNode;(i=n.dataset[e])&&this[i]&&this[i](t.target,t)}}])&&o(e.prototype,i),n&&o(e,n),t}(),s={preload:["https://leonardo.osnova.io/ebf78a5e-17de-3232-9662-f7246390cf28/","https://leonardo.osnova.io/15163648-ecb9-aab4-aba1-101569974476/","https://leonardo.osnova.io/ecf38820-d394-fed5-0bae-cf40abafa638/"],teaser:{title:"Сыграем в пятнашки?",button:"Да, легко!"},tip:{desktop:"Кликайте на&nbsp;квадраты, чтобы собрать пост",mobile:"Тапайте на&nbsp;квадраты, чтобы собрать пост"},image:{x1:"https://leonardo.osnova.io/f5456723-f56b-7678-8c5b-aaa6548449d3/",x2:"https://leonardo.osnova.io/f5456723-f56b-7678-8c5b-aaa6548449d3/"},fin:{start:"https://leonardo.osnova.io/80ebb3d8-b64d-a94b-46d3-e5ac6c2bd7c4/",end:"https://leonardo.osnova.io/6c9cd9f6-ef26-e413-c202-5a9825f057d2/"},booster:"https://leonardo.osnova.io/02e5ca97-b217-150e-68c7-b66cc2d843ac/",button:"Играть бесплатно",giveup:"Сдаюсь",noShowText:"Не показывать",url:"https://t.wizards.com/c/iz17vg?sub1=cpm&sub2=aff_DTF&sub3=opb-aff_DTF-all-affiliate-DTF&campaign=ik-oeurocampaign&ad_group=affiliate&ad=DTF"},c='<svg fill="none" viewBox="0 0 10 19" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#mtg-arrow-icon)"><path d="M10.001 9.998l-.844-1.043L2.316.5 0 2.59 6 10.002 0 17.41l2.315 2.09 6.841-8.455.844-1.047z" fill="#4DA0DA"/></g><defs><clipPath id="mtg-arrow-icon"><path transform="rotate(90 10 .5)" fill="#fff" d="M10 .5h19v10H10z"/></clipPath></defs></svg>';function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e,i){var n=1<arguments.length&&void 0!==e?e:[],a=2<arguments.length&&void 0!==i?i:[];t=t.toLowerCase();var o=document.createElement(t);for(var r in n&&("object"===l(n)?n.forEach(function(t){o.classList.add(t)}):"string"==typeof n&&o.classList.add(n)),a)if("data"===r){var s=a[r];for(var c in s)o.dataset[c]=s[c]}else o[r]=a[r];return o}function u(t,e,i){if(t||e){if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var a="; expires="+n.toGMTString()}else a="";return document.cookie=t+"="+e+a+"; path=/",1}}function h(t,a,o){var r=null,s=1e3*t,c=0;r=requestAnimationFrame(function t(e){var i,n=e-(c=c||e);a&&a((i=n/s)<.5?2*i*i:(4-2*i)*i-1,n),s<=n?(cancelAnimationFrame(r),o&&o()):r=requestAnimationFrame(t)})}var f=640;function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(o){return function(){var t,e,i,n=w(o);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var a=w(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==v(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b="mtg-puzzle",S="tile",T="start",z="wrapper",k="final",x="button",n=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(a,r);var t,e,i,n=y(a);function a(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),t=n.call(this),Object.assign(t.params,e),t.saveParams(),e.data&&Object.assign(s,e.data),t.params.css?t.loadStyles(t.params.css).then(function(){return t.init()}):t.init(),t}return t=a,(e=[{key:"setInitialParams",value:function(){var e=this;this.empty=8,this.width=640,this.height=this.width,this.screenWidth=this.container.offsetWidth,this.size=3,this.tileSize=Math.floor(this.width/this.size),this.order=[[8,7,1],[0,3,2],[6,5,4]],window.addEventListener("resize",function(t){e.screenWidth=e.container.offsetWidth})}},{key:"init",value:function(){var e=this;this.container.classList.add(b),this.container.classList.add(this.params.isFeed?"is-feed":"is-not-feed"),this.typeShowing=this.params.isFeed?"in Feed":"in Page",this.setInitialParams();var t=document.querySelector("#done");t&&t.addEventListener("click",function(){t.remove(),e.makeDone()});var i,n=document.querySelector("#show");n&&n.addEventListener("click",function(){u("mtg-puzzle",0),location.reload()}),1!=+function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return null}("mtg-puzzle")?(i=s.preload,Promise.all(i.map(function(i){return new Promise(function(t){var e=new Image;e.onload=t,e.src=i})})).then(function(t){e.addTeaser(),e.analyticsEvents(),e.container.classList.add("is-load"),function(t,e){if(location.hash===t){var i=e.getBoundingClientRect().top||0;window.addEventListener("load",function(){setTimeout(function(t){window.scrollTo(0,window.pageYOffset+i-60)},250)}),document.querySelector("body").classList.add("is-blured")}e.addEventListener("click",function t(){e.removeEventListener("click",t),document.querySelector("body").classList.remove("is-blured")})}("#15",e.container),setTimeout(function(t){e.screenWidth=e.container.offsetWidth},50)})):n&&(n.style.display="block")}},{key:"makeDone",value:function(){if(this.animation)return!1;this.animation=!0,this.ctx.canvas.click(),this.order=[[0,1,2],[3,4,5],[6,8,7]];var t=[this.getTile(0,0),this.getTile(0,1),this.getTile(0,2),this.getTile(1,0),this.getTile(1,1),this.getTile(1,2),this.getTile(2,0),this.getTile(2,1),this.getTile(2,2)];this.ctx.clearRect(0,0,this.width,this.height);for(var e=0;e<this.size;e++)for(var i=0;i<this.size;i++){var n=e*this.size+i;this.ctx.drawImage(t[n],i*this.tileSize,e*this.tileSize)}this.animation=!1}},{key:"start",value:function(){var h=this,t=s.image[window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)").matches)||window.devicePixelRatio&&window.devicePixelRatio,"x2"],f=p("img");f.onload=function(){var e=p("canvas",[],{width:h.width,height:h.height}),t=e.getContext("2d");h.ctx=t;var i=p("div",["".concat(b,"__container")]),n=p("div",["".concat(b,"__inner")]);n.appendChild(e),i.appendChild(n),h.toggleContainer=i,h.container.appendChild(i),h.container.appendChild(h.getStart()),["click"].forEach(function(t){e.addEventListener(t,h.tileClick.bind(h))}),t.drawImage(f,0,0,h.width,h.height);for(var a=[],o=0;o<h.size;o++)for(var r=0;r<h.size;r++){var s=p("canvas",["".concat(b,"__").concat(S)],{width:h.tileSize,height:h.tileSize});s.getContext("2d").drawImage(e,r*h.tileSize,o*h.tileSize,h.tileSize,h.tileSize,0,0,h.tileSize,h.tileSize),a.push(s)}h.tiles=a;var c=[h.getTile(0,0),h.getTile(0,1),h.getTile(0,2),h.getTile(1,0),h.getTile(1,1),h.getTile(1,2),h.getTile(2,0),h.getTile(2,1),h.getTile(2,2)];t.clearRect(0,0,h.width,h.height);for(var l=0;l<h.size;l++)for(var d=0;d<h.size;d++){var u=l*h.size+d;t.drawImage(c[u],d*h.tileSize,l*h.tileSize)}h.container.classList.add("is-start"),h.toggle(h.toggleContainer,void 0,function(t){h.start.classList.remove("is-hidden")})},f.src=t}},{key:"tileClick",value:function(t){var e=this;this.start&&this.start.classList.add("is-hidden"),this.isStarted||(d("".concat(this.typeShowing," — Start")),setTimeout(function(t){e.addGiveUpButton()},1e3)),this.isStarted=!0;var i=t.touches&&t.touches.length?t.touches[0].clientX:t.pageX,n=t.touches&&t.touches.length?t.touches[0].clientY:t.pageY,a=this.container.getBoundingClientRect(),o=window.scrollY||document.body.scrollTop||document.documentElement.scrollTop;i-=a.left,n-=o+a.top;var r=this.getTileNum(i,n);this.getNext(r)}},{key:"getNext",value:function(t){var e=this;if(this.animation)return!1;if(this.isFinish)return!1;var i=t<3?0:t<6?1:2,n=t-i*this.size,a=this.order[i][n];if(a===this.empty)return!1;var o=[[this.minmax(i-1),n],[this.minmax(1+i),n],[i,this.minmax(n-1)],[i,this.minmax(1+n)]],r=[this.order[this.minmax(i-1)][n],this.order[this.minmax(1+i)][n],this.order[i][this.minmax(n-1)],this.order[i][this.minmax(1+n)]],s=r.findIndex(function(t){return t===e.empty}),c=-1!==s&&o[s],l={nextTarget:r[s],nextCoords:c};!1!==l.nextCoords&&(this.order[i][n]=l.nextTarget,this.order[l.nextCoords[0]][l.nextCoords[1]]=a,this.animate(i,n,l.nextCoords[0],l.nextCoords[1]),this.checkFinish()&&(this.isFinish=!0,d("".concat(this.typeShowing," — Finish")),this.showFinal()))}},{key:"showFinal",value:function(){var i=this;this.showEmptyTile(),this.container.classList.remove("show-giveup"),setTimeout(function(t){var e=i.getFinal();i.container.appendChild(e),i.container.classList.add("is-final"),setTimeout(function(t){e.classList.add("is-show")},250)},350)}},{key:"showEmptyTile",value:function(){var t=this,e=this.getFinTile();e.classList.add("is-final-tile"),this.container.appendChild(e),setTimeout(function(t){e.classList.add("is-show")},100);var i=s.fin.end,n=p("img",["".concat(b,"__fin-img")]);n.onload=function(){t.container.appendChild(n),setTimeout(function(t){n.classList.add("is-show")},0),setTimeout(function(t){n.classList.add("is-move")},500)},n.src=i}},{key:"checkFinish",value:function(){var t=0===this.order[0][0],e=1===this.order[0][1],i=2===this.order[0][2],n=3===this.order[1][0],a=4===this.order[1][1],o=5===this.order[1][2],r=6===this.order[2][0],s=7===this.order[2][1],c=8===this.order[2][2];return t&&e&&i&&n&&a&&o&&r&&s&&c}},{key:"animate",value:function(a,o,r,s){var c=this;this.animation=!0,this.timer(.15,function(t){c.ctx.clearRect(o*c.tileSize,a*c.tileSize,c.tileSize,c.tileSize),c.ctx.clearRect(s*c.tileSize,r*c.tileSize,c.tileSize,c.tileSize);var e=c.getTile(r,s),i=r*c.tileSize-(r*c.tileSize-a*c.tileSize)*(1-t),n=s*c.tileSize-(s*c.tileSize-o*c.tileSize)*(1-t);c.ctx.drawImage(e,n,i,c.tileSize,c.tileSize)},function(t){var e=[c.getTile(0,0),c.getTile(0,1),c.getTile(0,2),c.getTile(1,0),c.getTile(1,1),c.getTile(1,2),c.getTile(2,0),c.getTile(2,1),c.getTile(2,2)];c.ctx.clearRect(0,0,c.width,c.height);for(var i=0;i<c.size;i++)for(var n=0;n<c.size;n++){var a=i*c.size+n;c.ctx.drawImage(e[a],n*c.tileSize,i*c.tileSize)}c.animation=!1})}},{key:"timer",value:function(t,a,o){var r=null,s=1e3*t,c=0;r=requestAnimationFrame(function t(e){var i,n=e-(c=c||e);a&&a((i=n/s)<.5?2*i*i:(4-2*i)*i-1,n),s<=n?(cancelAnimationFrame(r),o&&o()):r=requestAnimationFrame(t)})}},{key:"minmax",value:function(t){return Math.max(0,Math.min(t,this.size-1))}},{key:"getTileNum",value:function(t,e){var i=t/this.screenWidth,n=e/this.screenWidth,a=i<.3333?0:i<.6666?1:2;return(n<.3333?0:n<.6666?1:2)*this.size+a}},{key:"getEmpty",value:function(){return p("canvas",["".concat(b,"__").concat(S)],{width:this.tileSize,height:this.tileSize})}},{key:"getStart",value:function(){var t=p("div",["".concat(b,"__").concat(T),"is-hidden"]),e=p("div",["".concat(b,"__").concat(z)],{innerHTML:"".concat(c," <span>").concat(window.matchMedia("(min-width: ".concat(f,"px)")).matches?s.tip.desktop:s.tip.mobile,"</span> ").concat(c)});return t.appendChild(e),this.start=t}},{key:"getFinTile",value:function(){return this.tiles[this.getOrder(2,2)]}},{key:"getTile",value:function(t,e){var i=this.getOrder(t,e);return i===this.empty?this.getEmpty():this.tiles[i]}},{key:"getOrder",value:function(t,e){return this.order[t][e]}},{key:"getFinal",value:function(){var t=p("div",["".concat(b,"__").concat(k)]),e=p("a",["".concat(b,"__").concat(x)],{target:"_blank",href:s.url,innerHTML:s.button});return t.appendChild(e),t}},{key:"addGrid",value:function(){for(var t=p("div",["".concat(b,"__grid")]),e=0;e<=9;e++){var i=p("div",["".concat(b,"__cell")],{innerHTML:"<span></span><span></span>"});t.appendChild(i)}this.container.appendChild(t)}},{key:"analyticsEvents",value:function(){var a=this;d("".concat(this.typeShowing," — Widget"),"init");function o(){var t,e,i,n;t=a.container,e=t.getBoundingClientRect(),i=e.top,n=e.bottom,0<=i&&n<=window.innerHeight&&(d("".concat(a.typeShowing," — Widget"),"Show"),window.removeEventListener("scroll",o))}window.addEventListener("scroll",o),o()}},{key:"addGiveUpButton",value:function(){var e=this,t=p("div",["".concat(b,"__giveup")]),i=p("div",["".concat(b,"__button")],{innerHTML:s.giveup}),n=p("label",["".concat(b,"__label")]),a=p("span",["".concat(b,"__input")]),o=p("input",[],{type:"checkbox"}),r=p("span",[],{innerHTML:s.noShowText});o.addEventListener("change",function(t){n.classList[o.checked?"add":"remove"]("is-checked"),u("mtg-puzzle",o.checked?1:0),d("".concat(e.typeShowing," — ").concat(o.checked?"Checkbox (hide)":"Checkbox (show)"))}),a.appendChild(o),n.appendChild(a),n.appendChild(r),i.addEventListener("click",this.giveup.bind(this)),t.appendChild(i),t.appendChild(n),this.container.appendChild(t),setTimeout(function(t){e.container.classList.add("show-giveup")},0)}},{key:"giveup",value:function(){this.makeDone(),d("".concat(this.typeShowing," — Give up")),this.container.classList.remove("show-giveup")}},{key:"addTeaser",value:function(){var t=p("div",["".concat(b,"__teaser")]),e=p("div",["".concat(b,"__hading")],{innerHTML:s.teaser.title}),i=p("div",["".concat(b,"__easy")],{innerHTML:s.teaser.button});t.appendChild(e),t.appendChild(i),i.addEventListener("click",this.startGame.bind(this,t)),this.container.appendChild(t)}},{key:"startGame",value:function(t){t.classList.add("is-hidden"),this.toggle(t),d("".concat(this.typeShowing," — Teaser")),this.start()}},{key:"toggle",value:function(e,t,i){var n=void 0===t?0===e.offsetHeight:!t,a=e.children[0].offsetHeight;e.classList[n?"add":"remove"]("is-show"),h(.5,function(t){e.style.height=(n?t:1-t)*a+"px"},function(){e.style.height=n?"auto":"0",i&&i()})}}])&&m(t.prototype,e),i&&m(t,i),a}()}]);
//# sourceMappingURL=all.js.map